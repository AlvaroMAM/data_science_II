{% extends "base.html" %}

{% block head %}

<title title>Profile</title>

<link rel="stylesheet" href="../static/css/profile.css" />

{% endblock %}

{% block content %}

<div class="title">
    <h1>Welcome #username</h1>
</div>


<div class="airlines_container">

    <h4 class="airlines_title"> Airlines </h3>
        
    <div class="page">
        <div class="select-dropdown">
            <select>
                {% for airline in airlines %}
                <option value="{{ airline.id }}">{{ airline.airline }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <button id="add_to_favorite" type="button" class="btn btn-primary">Add To Favorites</button>

</div>

<br>

<div class="fav_airlines_title"> 
    <h4> Favorites Airlines </h4>
</div>

{% if fav_airlines |count == 0 %}
<div class="empty_state">
    <img src="static/images/sad.png" alt="">
    <h3 class="empty-state-title">No Favorites Yet!</h3>
  </div>
{% else %}

<div class="grid">
    <div class="grid-cards">

        {% for fav_airline in fav_airlines %}

        <div class="gridc-cards-inner">
            <button class="delete" onclick="deleteFavAirline('{{ fav_airline["id"] }}')" type="button">
                <svg class="deleteIcon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            </button>
            <img class="plane-icon" src="static/images/plane.png" alt="">
            <p class="fav_airline"> {{ fav_airline["airline"] }} </p>
            <p class="iata_code"> {{ fav_airline["iata_code"] }}  </p>
        </div>

        {% endfor %}

    </div>
</div>


{% endif %}

<script>

    function deleteFavAirline(id) {
        let result = confirm("Are You Sure?");
        if (result) {
            window.location.assign("/favorites/delete?id=" + id);
        }
    }

    function refreshWindow() {
        window.location.reload();
      }

    window.addEventListener('load', function () {

        const airlineSelect = document.querySelector('.select-dropdown select');

        document.getElementById('add_to_favorite').addEventListener('click', function() {
    
            const selectedAirline = airlineSelect.value;
    
            console.log(selectedAirline);
    
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "/favorites");
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xhr.send(JSON.stringify({
                id: selectedAirline
            }));
            setTimeout(refreshWindow, 700);
            
        });


    }, false);

</script>


{# <form method="POST">
    {{ form.hidden_tag() }}
    {{ form.name.label }} {{ form.name() }}
    {{ form.email.label }} {{ form.email() }}
    {{ form.submit() }}
</form>

<h2>Favourites</h2>
<form method="POST">
    {{ favorites_form.hidden_tag() }}
    {{ favorites_form.favourites_airlines.label }} {{ favorites_form.favourites_airlines() }}
    {{ favorites_form.favourites_airports.label }} {{ favorites_form.favourites_airports() }}
    {{ favorites_form.submit() }}
#}

{% endblock %}
``
